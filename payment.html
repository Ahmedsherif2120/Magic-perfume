<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>نخبة للعطور - صفحة الدفع</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">

  <div class="max-w-md mx-auto bg-white shadow-lg rounded-xl mt-10 p-6 space-y-6">

    <!-- صورة المنتج -->
    <div class="text-center">
      <img id="productImage" src="" alt="صورة المنتج" class="rounded-xl mx-auto mb-4 w-60 h-60 object-cover" />
      <h2 id="productName" class="text-xl font-bold mt-2"></h2>
    </div>

    <!-- الكمية والسعر -->
    <div>
      <label for="quantity" class="block mb-1 font-semibold">الكمية:</label>
      <input type="number" id="quantity" min="1" value="1" class="w-full border rounded-lg px-3 py-2 text-right" />
      <p class="mt-2 font-bold">السعر الإجمالي: <span id="totalPrice">0</span> جنيه</p>
    </div>

    <!-- بيانات العميل -->
    <div>
      <label class="block mb-1 font-semibold">اسم العميل:</label>
      <input type="text" id="customerName" class="w-full border rounded-lg px-3 py-2 text-right" />

      <label class="block mt-4 mb-1 font-semibold">رقم الهاتف:</label>
      <input type="tel" id="customerPhone" class="w-full border rounded-lg px-3 py-2 text-right" />
    </div>

    <!-- تعليمات الدفع -->
    <div class="bg-purple-100 border border-purple-300 text-purple-800 rounded-lg p-4 text-sm leading-relaxed">
      <span>① اختر طريقة الدفع: فودافون كاش أو إنستا بي.</span><br>
      <span>② بعد الدفع، خذ سكرين شوت للإيصال.</span><br>
      <span>③ اضغط على 'إرسال الإيصال على واتساب' وسيتم توجيهك تلقائيًا.</span>
    </div>

    <!-- زر اختيار وسيلة الدفع -->
    <div class="flex justify-center gap-4 my-4">
      <button id="vodafoneBtn" class="payment-method px-6 py-2 border rounded-lg text-white bg-gray-600 hover:bg-red-600 transition">
        فودافون كاش<br><span class="text-sm">01001234567</span>
      </button>
      <button id="instapayBtn" class="payment-method px-6 py-2 border rounded-lg text-white bg-gray-600 hover:bg-blue-600 transition">
        إنستا بي<br><span class="text-sm">yourname@instapay</span>
      </button>
    </div>

    <!-- زر إرسال الإيصال -->
    <div id="whatsappSection" class="text-center hidden">
      <a id="whatsappLink" href="#" target="_blank" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
        إرسال إيصال الدفع على واتساب
      </a>
    </div>
  </div>

  <!-- سكريبت -->
  <script>
    const query = new URLSearchParams(window.location.search);
    const imgSrc = query.get("img");
    const unitPrice = parseInt(query.get("price")) || 0;

    const productImage = document.getElementById("productImage");
    const quantityInput = document.getElementById("quantity");
    const totalPriceElement = document.getElementById("totalPrice");
    const customerName = document.getElementById("customerName");
    const customerPhone = document.getElementById("customerPhone");
    const whatsappLink = document.getElementById("whatsappLink");
    const whatsappSection = document.getElementById("whatsappSection");

    const vodafoneBtn = document.getElementById("vodafoneBtn");
    const instapayBtn = document.getElementById("instapayBtn");
    const whatsappNumber = "01121395320";

    // عرض صورة المنتج
    if (imgSrc) {
      productImage.src = decodeURIComponent(imgSrc);
    }

    // تحديث السعر الإجمالي عند تغيير الكمية
    function updateTotalPrice() {
      const quantity = parseInt(quantityInput.value) || 1;
      totalPriceElement.textContent = quantity * unitPrice;
    }

    quantityInput.addEventListener("input", updateTotalPrice);
    updateTotalPrice();

    function updateButtons(activeBtn, inactiveBtn, method) {
      activeBtn.classList.add("bg-" + (method === "vodafone" ? "red" : "blue") + "-600");
      inactiveBtn.classList.remove("bg-red-600", "bg-blue-600");

      const name = encodeURIComponent(customerName.value || "العميل");
      const phone = encodeURIComponent(customerPhone.value || "بدون رقم");
      const quantity = parseInt(quantityInput.value) || 1;
      const total = quantity * unitPrice;

      const message = `✅ طلب جديد من ${name}\n📞 رقم الهاتف: ${phone}\n💳 طريقة الدفع: ${method === "vodafone" ? "فودافون كاش" : "إنستا بي"}\n📦 الكمية: ${quantity}\n💰 السعر الإجمالي: ${total} جنيه\n\nمن فضلك أرسل الإيصال هنا.`;

      whatsappLink.href = `https://wa.me/2${whatsappNumber}?text=${encodeURIComponent(message)}`;
      whatsappSection.classList.remove("hidden");
    }

    vodafoneBtn.addEventListener("click", () => {
      updateButtons(vodafoneBtn, instapayBtn, "vodafone");
    });

    instapayBtn.addEventListener("click", () => {
      updateButtons(instapayBtn, vodafoneBtn, "instapay");
    });
  </script>
</body>
</html>
